(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.holmes=b()})(this,function(){'use strict';function f(a){return f='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},f(a)}function a(a){this.wrapped=a}function b(b){function c(e,f){try{var g=b[e](f),h=g.value,i=h instanceof a;Promise.resolve(i?h.wrapped:h).then(function(a){return i?void c('next',a):void d(g.done?'return':'normal',a)},function(a){c('throw',a)})}catch(a){d('throw',a)}}function d(a,b){switch(a){case'return':e.resolve({value:b,done:!0});break;case'throw':e.reject(b);break;default:e.resolve({value:b,done:!1});}e=e.next,e?c(e.key,e.arg):f=null}var e,f;this._invoke=function(a,b){return new Promise(function(d,g){var h={key:a,arg:b,resolve:d,reject:g,next:null};f?f=f.next=h:(e=f=h,c(a,b))})},'function'!=typeof b.return&&(this.return=void 0)}function g(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function c(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function d(a,b,d){return b&&c(a.prototype,b),d&&c(a,d),a}function e(){if('undefined'==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if('function'==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function h(){return h=e()?Reflect.construct:function(b,c){var d=[null];d.push.apply(d,c);var a=Function.bind.apply(b,d),e=new a;return e},h.apply(null,arguments)}'function'==typeof Symbol&&Symbol.asyncIterator&&(b.prototype[Symbol.asyncIterator]=function(){return this}),b.prototype.next=function(a){return this._invoke('next',a)},b.prototype.throw=function(a){return this._invoke('throw',a)},b.prototype.return=function(a){return this._invoke('return',a)};var i='undefined'==typeof window?global:window,j=function(c,a){return-1!==c.indexOf(a)},k={invalidInput:'The Holmes input was no <input> or contenteditable.',optionsObject:'The options need to be given inside an object like this:\n\nnew Holmes({\n  find:".result"\n});\n\nsee also https://haroen.me/holmes/doc/holmes.html',findOption:'A find argument is needed. That should be a querySelectorAll for each of the items you want to match individually. You should have something like:\n\nnew Holmes({\n  find:".result"\n});\n\nsee also https://haroen.me/holmes/doc/holmes.html',noInput:'Your Holmes.input didn\'t match a querySelector',impossiblePlaceholder:'The Holmes placeholder couldn\'t be put; the elements had no parent.'},l=function(){function h(a){var i=this;g(this,h);var c=!1;if('object'!==f(a))throw new Error(k.optionsObject);if('string'!=typeof a.find)throw new Error(k.findOption);var b={input:'input[type=search]',find:'',placeholder:void 0,mark:!1,class:{visible:void 0,hidden:'hidden'},dynamic:!1,minCharacters:0,hiddenAttr:!1,shouldShow:j,onHidden:void 0,onVisible:void 0,onEmpty:void 0,onFound:void 0,onInput:void 0};this.options=Object.assign({},b,a),this.options['class']=Object.assign({},b['class'],a['class']),this.hidden=0,this.running=!1,window.addEventListener('DOMContentLoaded',function(){return i.start()}),this.search=function(){i.running=!0;var d=!1;i.searchString=i.inputString(),i.options.minCharacters&&0!==i.searchString.length&&i.options.minCharacters>i.searchString.length||(i.options.dynamic&&(i.elements=document.querySelectorAll(i.options.find),i.elementsLength=i.elements.length,i.elementsArray=Array.prototype.slice.call(i.elements)),i.options.mark&&(i._regex=new RegExp('('.concat(i.searchString,')(?![^<]*>)'),'gi')),i.elementsArray.forEach(function(a){i.options.shouldShow(a.textContent.toLowerCase(),i.searchString)?(i._showElement(a),c&&'function'==typeof i.options.onFound&&i.options.onFound(i.placeholderNode),d=!0):i._hideElement(a)}),'function'==typeof i.options.onInput&&i.options.onInput(i.searchString),d?i.options.placeholder&&i._hideElement(i.placeholderNode):(i.options.placeholder&&i._showElement(i.placeholderNode),!1==c&&(c=!0,'function'==typeof i.options.onEmpty&&i.options.onEmpty(i.placeholderNode))))}}return d(h,[{key:'_hideElement',value:function(b){this.options['class'].visible&&b.classList.remove(this.options['class'].visible),b.classList.contains(this.options['class'].hidden)||(b.classList.add(this.options['class'].hidden),this.hidden++,'function'==typeof this.options.onHidden&&this.options.onHidden(b)),this.options.hiddenAttr&&b.setAttribute('hidden','true'),this.options.mark&&(b.innerHTML=b.innerHTML.replace(/<\/?mark>/g,''))}},{key:'_showElement',value:function(b){this.options['class'].visible&&b.classList.add(this.options['class'].visible),b.classList.contains(this.options['class'].hidden)&&(b.classList.remove(this.options['class'].hidden),this.hidden--,'function'==typeof this.options.onVisible&&this.options.onVisible(b)),this.options.hiddenAttr&&b.removeAttribute('hidden'),this.options.mark&&(b.innerHTML=b.innerHTML.replace(/<\/?mark>/g,''),this.searchString.length&&(b.innerHTML=b.innerHTML.replace(this._regex,'<mark>$1</mark>')))}},{key:'_inputHandler',value:function(){console.warn('You can now directly call .search() to refresh the results'),this.search()}},{key:'inputString',value:function(){if(this.input instanceof HTMLInputElement)return this.input.value.toLowerCase();if(this.input.isContentEditable)return this.input.textContent.toLowerCase();throw new Error(k.invalidInput)}},{key:'setInput',value:function(b){if(this.input instanceof HTMLInputElement)this.input.value=b;else if(this.input.isContentEditable)this.input.textContent=b;else throw new Error(k.invalidInput)}},{key:'start',value:function(){var d=document.querySelector(this.options.input);if(d instanceof HTMLElement)this.input=d;else throw new Error(k.noInput);if('string'==typeof this.options.find)this.elements=document.querySelectorAll(this.options.find);else throw new Error(k.findOption);if(this.elementsLength=this.elements.length,this.elementsArray=Array.prototype.slice.call(this.elements),this.hidden=0,'string'==typeof this.options.placeholder){var a=this.options.placeholder;if(this.placeholderNode=document.createElement('div'),this.placeholderNode.id='holmes-placeholder',this._hideElement(this.placeholderNode),this.placeholderNode.innerHTML=a,this.elements[0].parentNode instanceof Element)this.elements[0].parentNode.appendChild(this.placeholderNode);else throw new Error(k.impossiblePlaceholder)}if(this.options['class'].visible){var b=this.options['class'].visible;this.elementsArray.forEach(function(c){c.classList.add(b)})}this.input.addEventListener('input',this.search)}},{key:'stop',value:function(){var d=this;return new Promise(function(a,b){try{d.input.removeEventListener('input',d.search),d.options.placeholder&&(d.placeholderNode.parentNode?d.placeholderNode.parentNode.removeChild(d.placeholderNode):b(new Error(k.impossiblePlaceholder))),d.options.mark&&d.elementsArray.forEach(function(b){b.innerHTML=b.innerHTML.replace(/<\/?mark>/g,'')}),d.running=!1,a('This instance of Holmes has been stopped.')}catch(c){b(c)}})}},{key:'clear',value:function(){var c=this;this.setInput(''),this.elementsArray.forEach(function(a){c._showElement(a)}),this.options.placeholder&&this._hideElement(this.placeholderNode),this.hidden=0}},{key:'count',value:function(){return{all:this.elementsLength,hidden:this.hidden,visible:this.elementsLength-this.hidden}}}]),h}(),m=function(f){var a=function(){for(var a,b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return a='undefined'!=typeof this&&this!==i?f.call.apply(f,[this].concat(c)):h(f,c),a};return a.__proto__=f,a.prototype=f.prototype,a}(l);return m});
